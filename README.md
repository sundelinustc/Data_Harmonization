# Data_Harmonization
## Background
Results of neuroimaging datasets aggregated from multiple sites may be biased by site-specific profiles in participants’ demographic and clinical characteristics, as well as MRI acquisition protocols and scanning platforms. We compared the impact of four different harmonization methods on results of analyses of cortical thickness data derived from brain MRI: a linear mixed-effects model (LME) that models site-specific random intercepts (LMEINT), an LME that models both site-specific random intercepts and age-related random slopes (LMEINT+SLP), ComBat, and ComBat with a generalized additive model (ComBat-GAM). Our test case for comparing harmonization methods was cortical thickness data aggregated from 29 sites grouped into cases with posttraumatic stress disorder (PTSD) (N=1,344) and controls without PTSD who were exposed to trauma (N=2,073). 
![Figure 1](https://github.com/sundelinustc/Data_Harmonization/blob/main/Figure1.png?raw=true)
We found that, compared to the other data harmonization methods, results from data processed with ComBat-GAM were more sensitive for detecting regions showing significant case-control differences in cortical thickness, and case-control differences in age-related cortical thinning. Use of ComBat-GAM led to larger estimates of cortical thickness reductions, smaller age-appropriate declines and lower female to male contrast in cases compared to controls. Normalization with ComBat-GAM also led to greater estimates of age-related declines in cortical thickness in both cases and controls. Our results support the use of ComBat-GAM for harmonizing cortical thickness data aggregated from multiple sites and platforms to minimize confounds and increase statistical power. 
![Figure 3](https://github.com/sundelinustc/Data_Harmonization/blob/main/Figure3.png?raw=true)
## Participants
Data were obtained for secondary analysis from the PGC-ENIGMA PTSD Working Group. The dataset originated from 29 sites located in five continents (PTSD/Control N = 1,343/2,067).All study sites obtained approval from local institutional review boards or ethics committees. All participants provided written informed consent. 
## Imaging Data Preprocessing
Anatomical brain images were preprocessed at Duke University through a standardized neuroimaging and QC pipeline developed by the ENIGMA Consortium (http://enigma.ini.usc.edu/protocols/imaging-protocols/) (Logue et al., 2018). Cortical thickness measurements were generated by FreeSurfer software (https://surfer.nmr.mgh.harvard.edu) based on the Destrieux atlas (Destrieux, Fischl, Dale, & Halgren, 2010) that contains 74 regions per hemisphere. In brief, white matter surfaces were deformed toward the gray matter boundary at each surface vertex. Cortical thickness was calculated based on the average distance between the parcellated portions of white and pial surfaces within each region per participant. 
## ComBat Harmonization 
The ComBat approach removes the effects of site while preserving inherent biological variance in the data (Fortin et al., 2018). In the present study, PTSD diagnosis, age, and sex were designated as biological variables. The ComBat approach was implemented using the R scripts (https://github.com/Jfortin1/ComBatHarmonization) running on RStudio (ver. 1.3.1073) and R (ver. 4.0.2). Unlike implementations of LME models that merge data harmonization and statistical analyses, ComBat and ComBat-GAM performs only harmonization and makes the harmonized data available to the user. 
## ComBat-GAM Harmonization
PTSD diagnosis, age, and sex were designated as biological variables, and age was specified as a non-linear term in the model. The ComBat-GAM approach was implemented using Python (ver. 3.7.6) scripts (https://github.com/rpomponio/neuroHarmonize).
## Statistical Models
In all models, sex, age, and PTSD diagnosis were included as fixed factors to estimate their effects on the cortical thickness of each cortical region, and as covariates for testing interaction effects. Either age by caseness interaction or sex by caseness interaction was included in the models as a fixed factor when the corresponding interaction was of interest. Linear modeling was utilized to analyze data harmonized by ComBat and data harmonized by ComBat-GAM. Cortical thickness data without harmonization was entered into the LME models. The LME (int) employed study site as a random factor to model the random intercepts. The LME (int+slp) modeled both the site-specific random intercepts and age-related random slopes, which reflect the fact that the slopes of age-related changes in cortical thickness are different across sites (Fig. 1). The Bonferroni method was employed to correct for multiple testing of 148 cortical regions for a corrected α = 0.0003 (0.05/148). The R packages lme4, and lmerTest were utilized to calculate regression coefficients and statistical significance. 
